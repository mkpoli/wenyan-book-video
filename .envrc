# Use direnv to automatically load the Nix development environment
# Install direnv: nix profile install nixpkgs#direnv
# Then run: direnv allow

# Explicitly clear LD_LIBRARY_PATH to prevent VSCode/system interference
# VSCode may set LD_LIBRARY_PATH pointing to system libraries, which conflicts
# with Nix packages. Setting it to empty string works correctly.
export LD_LIBRARY_PATH=""

use flake

# Display welcome message and available commands
# Redirect to stderr so direnv displays it (direnv shows stderr output)
if test -z "$_DIRENV_WELCOME_SHOWN"; then
  {
    echo ""
    echo "ðŸ‰ Wenyan Book Video Development Environment"
    echo ""
    command -v python >/dev/null 2>&1 && echo "Python: $(python --version 2>&1)" || echo "Python: loading..."
    command -v uv >/dev/null 2>&1 && echo "uv: $(uv --version 2>&1)" || echo "uv: loading..."
    command -v node >/dev/null 2>&1 && echo "Node.js: $(node --version 2>&1)" || echo "Node.js: loading..."
    command -v ffmpeg >/dev/null 2>&1 && echo "FFmpeg: $(ffmpeg -version 2>&1 | head -n 1)" || echo "FFmpeg: available"
    echo ""
    echo "Available commands:"
    echo "  segment-text    - Edit segment-text.py with marimo"
    echo "  audio-femalize  - Edit audio-femalize.py with marimo"
    echo "  main            - Run main.py"
    echo ""
    echo "Available tools:"
    echo "  - Python 3.13 (managed by uv)"
    echo "  - All Python packages from pyproject.toml (via uv)"
    echo "  - Node.js (for book scripts)"
    echo "  - FFmpeg, SoX (audio processing)"
    echo ""
  } >&2
  export _DIRENV_WELCOME_SHOWN=1
fi

