# AGENTS.md

## Purpose
- Coordinate work on the Wenyan Book Video monorepo so that automation agents share the same expectations and tools.

## Key Practices
- Always use the `bun` command (e.g., `bun install`, `bun run …`) instead of `npm` or `npx` for any JavaScript/TypeScript task.
- In `processor/`, the Python environment are all managed by `uv`. ALWAYS `cd processor` first, then use `uv run <script_name>` to run Python scripts. Do NOT run from the root like `python3 processor/script.py` or `uv run processor/script.py`. When importing, the whole processor is a package itself, so if you are in it, just import relatively, i.e use `from utils.cli_style import print_warning` instead of `from processor.utils.cli_style import print_warning`.
- Keep the `book/` directory in sync via git submodules; only modify it when intentionally updating the upstream text and commit the submodule pointer, not the contents.
- Prefer incremental changes plus small, verifiable commits; document any generated assets or large outputs rather than committing binaries unless explicitly required.

## Workflow Highlights
1. **Setup** – After cloning, execute `git submodule update --init --recursive`, then `bun install` in the repo root so all workspaces share dependencies.
2. **Processing** – Use the Python tools in `processor/` (see `processor/README.md`) to create JSON, audio, and transcript artifacts that populate `renderer/public/**`.
3. **Segment Generation** – From `renderer/`, run `bun run scripts/generate-segments.ts` to materialize `renderer/src/generated/segments-*.ts` files once new processor output is ready.
4. **Rendering** – Still inside `renderer/`, run `bun run remotion render` to produce final videos; make sure the previously generated assets exist before rendering.

## Important Folders
1. **renderer/public/chapters** - where the chapter metadata is generated with the original block (markdown paragraphs) information, generated by `processor/parse-markdown.py`
2. **renderer/public/sentences** - generated by `processor/build-sentences.py`
3. **renderer/public/transcripts** - generated by `processor/transcribe.py` with human review.
4. **renderer/public/translations** - generated by `processor/translate.py` with human review.
5. **renderer/public/segments** - generated by `processor/segment-text.py` with human review.

## Additional Notes
- Large media folders (`audios/`, `segments/`, `timings/`, etc.) can be regenerated; avoid editing them manually unless a pipeline script explicitly requires it.
- Keep README files current whenever you adjust workflows so future agents inherit accurate instructions.
